<?php

/**
 * @file
 * Primary module hooks for Protected Content module.
 */

require_once 'inc/proc.functions.inc';

 /**
 * Implements hook_form_alter().
 */
function proc_form_proc_keys_generation_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
  $proc_data = _proc_common_get_decryption_form_data(NULL);

  $form['#attached'] = [
    'library' => [
      0 => 'proc/openpgpjs',
      1 => 'proc/proc-generate-keys',
    ],
    'drupalSettings' => [
      'proc' => [
        'proc_labels' => _proc_js_labels(),
        'proc_data'   => $proc_data, 
      ]
    ],
  ];

  $path_service = \Drupal::service('redirect.destination')->getAsArray()['destination'];
  $form['#action'] = $path_service;

}

 /**
 * Implements hook_form_alter().
 */
function proc_form_proc_encrypt_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
  $proc_data = _proc_common_get_decryption_form_data(NULL);

  $current_path = \Drupal::service('path.current')->getPath();
  $path_array = explode('/', $current_path);

  // ksm($path_array[3]);

  $form['#attached'] = [
    'library' => [
      0 => 'proc/openpgpjs',
      1 => 'proc/proc-encrypt',
    ],
    'drupalSettings' => [
      'proc' => [
        'proc_labels' => _proc_js_labels(),
        'proc_data'   => $proc_data,
        // @todo: turn this into a configuration:
        'proc_file_entity_max_filesize' => 999999,
        'proc_post_max_size_bytes' => 999999,
        'proc_recipients_pubkeys_changed' => json_encode(['1' => 5555, '2' => 5555]),
        'basePath' => '/drupal/d92/web/',


      ]
    ],
  ];
  $form['#action'] = 'generate-keys';

  
}